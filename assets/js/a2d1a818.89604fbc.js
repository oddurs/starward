"use strict";(globalThis.webpackChunkstarward_docs=globalThis.webpackChunkstarward_docs||[]).push([[1739],{6329(e,t,s){s.r(t),s.d(t,{assets:()=>d,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>n,toc:()=>o});let n=JSON.parse('{"id":"development/testing","title":"Testing","description":"Comprehensive guide to the starward test suite and Allure reporting","source":"@site/../docs/development/testing.md","sourceDirName":"development","slug":"/development/testing","permalink":"/docs/development/testing","draft":false,"unlisted":false,"editUrl":"https://github.com/oddurs/starward/tree/master/../docs/development/testing.md","tags":[],"version":"current","lastUpdatedBy":"Oddur Sigurdsson","lastUpdatedAt":1768356820000,"sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"Testing","description":"Comprehensive guide to the starward test suite and Allure reporting"},"sidebar":"development","previous":{"title":"Developer Overview","permalink":"/docs/development/overview"},"next":{"title":"Contributing","permalink":"/docs/development/contributing"}}');var r=s(4848),i=s(8453);let l={sidebar_position:2,title:"Testing",description:"Comprehensive guide to the starward test suite and Allure reporting"},a="Testing Infrastructure",d={},o=[{value:"Test Suite Overview",id:"test-suite-overview",level:2},{value:"Running Tests",id:"running-tests",level:2},{value:"Basic Commands",id:"basic-commands",level:3},{value:"Using the Makefile",id:"using-the-makefile",level:3},{value:"Test Markers",id:"test-markers",level:2},{value:"Allure Reporting",id:"allure-reporting",level:2},{value:"Report Structure",id:"report-structure",level:3},{value:"Allure Decorators",id:"allure-decorators",level:3},{value:"Generating Reports",id:"generating-reports",level:3},{value:"Report Features",id:"report-features",level:3},{value:"Test Fixtures",id:"test-fixtures",level:2},{value:"Observer Locations",id:"observer-locations",level:3},{value:"Famous Stars",id:"famous-stars",level:3},{value:"Reference Times",id:"reference-times",level:3},{value:"Writing Tests",id:"writing-tests",level:2},{value:"Educational Docstrings",id:"educational-docstrings",level:3},{value:"Step Annotations",id:"step-annotations",level:3},{value:"Golden Tests",id:"golden-tests",level:3},{value:"Coverage",id:"coverage",level:2}];function c(e){let t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"testing-infrastructure",children:"Testing Infrastructure"})}),"\n",(0,r.jsxs)(t.p,{children:["starward maintains a comprehensive test suite with ",(0,r.jsx)(t.strong,{children:"872 tests"})," covering all astronomical calculations. The tests serve dual purposes: ensuring correctness and providing educational documentation of astronomical concepts."]}),"\n",(0,r.jsx)(t.h2,{id:"test-suite-overview",children:"Test Suite Overview"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"tests/\n\u251C\u2500\u2500 conftest.py              # Shared fixtures (observers, coordinates, stars)\n\u251C\u2500\u2500 allure/                  # Allure helpers and step functions\n\u2502   \u251C\u2500\u2500 helpers.py           # Reusable step decorators\n\u2502   \u2514\u2500\u2500 categories.json      # Test categorization rules\n\u251C\u2500\u2500 core/                    # Core module tests\n\u2502   \u251C\u2500\u2500 test_angles.py       # Angular measurements (84 tests)\n\u2502   \u251C\u2500\u2500 test_coords.py       # Coordinate systems (38 tests)\n\u2502   \u251C\u2500\u2500 test_time.py         # Julian Date, sidereal time (46 tests)\n\u2502   \u251C\u2500\u2500 test_sun.py          # Solar calculations (28 tests)\n\u2502   \u251C\u2500\u2500 test_moon.py         # Lunar calculations (26 tests)\n\u2502   \u251C\u2500\u2500 test_planets.py      # Planetary ephemerides (37 tests)\n\u2502   \u251C\u2500\u2500 test_visibility.py   # Observability (31 tests)\n\u2502   \u251C\u2500\u2500 test_constants.py    # Astronomical constants (28 tests)\n\u2502   \u251C\u2500\u2500 test_messier.py      # Messier catalog (43 tests)\n\u2502   \u251C\u2500\u2500 test_ngc.py          # NGC catalog (44 tests)\n\u2502   \u251C\u2500\u2500 test_ic.py           # IC catalog (43 tests)\n\u2502   \u251C\u2500\u2500 test_caldwell.py     # Caldwell catalog (40 tests)\n\u2502   \u2514\u2500\u2500 test_hipparcos.py    # Hipparcos catalog (50 tests)\n\u251C\u2500\u2500 cli/                     # CLI integration tests\n\u2502   \u2514\u2500\u2500 test_commands.py     # Command-line interface (34 tests)\n\u251C\u2500\u2500 integration/             # End-to-end workflows\n\u2502   \u2514\u2500\u2500 test_workflows.py    # Multi-module integration (8 tests)\n\u2514\u2500\u2500 output/                  # Formatter tests\n    \u2514\u2500\u2500 test_formatters.py   # Rich output formatting (10 tests)\n"})}),"\n",(0,r.jsx)(t.h2,{id:"running-tests",children:"Running Tests"}),"\n",(0,r.jsx)(t.h3,{id:"basic-commands",children:"Basic Commands"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:'# Run all tests (quiet mode)\npytest\n\n# Run with verbose output\npytest -v\n\n# Run specific test file\npytest tests/core/test_sun.py\n\n# Run tests matching a pattern\npytest -k "moon"\n\n# Run with coverage report\npytest --cov=starward --cov-report=html\n'})}),"\n",(0,r.jsx)(t.h3,{id:"using-the-makefile",children:"Using the Makefile"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"# Run tests with Allure results\nmake test\n\n# Generate and open Allure report\nmake report\n\n# Clean test artifacts\nmake clean\n"})}),"\n",(0,r.jsx)(t.h2,{id:"test-markers",children:"Test Markers"}),"\n",(0,r.jsx)(t.p,{children:"Tests are organized using pytest markers for selective execution:"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Marker"}),(0,r.jsx)(t.th,{children:"Description"}),(0,r.jsx)(t.th,{children:"Example"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"@pytest.mark.golden"})}),(0,r.jsx)(t.td,{children:"Reference value tests (high-accuracy validation)"}),(0,r.jsx)(t.td,{children:"Sun position at J2000.0"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"@pytest.mark.slow"})}),(0,r.jsx)(t.td,{children:"Tests that take longer to execute"}),(0,r.jsx)(t.td,{children:"Monte Carlo validation"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"@pytest.mark.edge"})}),(0,r.jsx)(t.td,{children:"Edge case and boundary tests"}),(0,r.jsx)(t.td,{children:"Poles, date line"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"@pytest.mark.skip"})}),(0,r.jsx)(t.td,{children:"Temporarily skipped (with reason)"}),(0,r.jsx)(t.td,{children:"Unimplemented features"})]})]})]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:'# Run only golden tests\npytest -m golden\n\n# Skip slow tests\npytest -m "not slow"\n\n# Run edge case tests\npytest -m edge\n'})}),"\n",(0,r.jsx)(t.h2,{id:"allure-reporting",children:"Allure Reporting"}),"\n",(0,r.jsxs)(t.p,{children:["The test suite uses ",(0,r.jsx)(t.a,{href:"https://docs.qameta.io/allure/",children:"Allure"})," for rich, interactive test reports."]}),"\n",(0,r.jsx)(t.h3,{id:"report-structure",children:"Report Structure"}),"\n",(0,r.jsx)(t.p,{children:"Tests are organized into a hierarchy:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Epic"}),': Top-level category (e.g., "Core Calculations")']}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Feature"}),': Module being tested (e.g., "Sun Module")']}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Story"}),': Test class grouping (e.g., "Solar Position")']}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Test"}),": Individual test case with steps"]}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"allure-decorators",children:"Allure Decorators"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-python",children:'import allure\nimport pytest\n\n@allure.epic("Core Calculations")\n@allure.feature("Sun Module")\n@allure.story("Solar Position")\nclass TestSunPosition:\n    """Tests for solar position calculations."""\n\n    @pytest.mark.golden\n    @allure.title("Sun position at J2000.0")\n    @allure.description("""\n    At J2000.0 (Jan 1, 2000 12:00 TT), the Sun should be at:\n    - RA: ~281\xb0 (in Sagittarius)\n    - Dec: ~-23\xb0 (near winter solstice)\n    """)\n    def test_sun_at_j2000(self):\n        """Sun position at the J2000.0 epoch."""\n        with allure.step("Set reference date: J2000.0"):\n            jd = JulianDate(2451545.0)\n\n        with allure.step("Calculate sun position"):\n            pos = sun_position(jd)\n\n        with allure.step(f"Verify RA = {pos.ra.degrees:.2f}\xb0"):\n            assert 270 < pos.ra.degrees < 290\n'})}),"\n",(0,r.jsx)(t.h3,{id:"generating-reports",children:"Generating Reports"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"# Run tests (generates allure-results/)\npytest --clean-alluredir\n\n# Serve report locally\nallure serve allure-results\n\n# Generate static HTML report\nallure generate allure-results -o allure-report\n"})}),"\n",(0,r.jsx)(t.h3,{id:"report-features",children:"Report Features"}),"\n",(0,r.jsx)(t.p,{children:"The Allure report includes:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Test execution timeline"})," \u2014 Visual overview of test runs"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Step-by-step breakdown"})," \u2014 Each ",(0,r.jsx)(t.code,{children:"with allure.step()"})," shown in detail"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Attachments"})," \u2014 Screenshots, logs, computed values"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Categories"})," \u2014 Automatic grouping of failures by type"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"History"})," \u2014 Trends across multiple test runs"]}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"test-fixtures",children:"Test Fixtures"}),"\n",(0,r.jsxs)(t.p,{children:["Common test fixtures are defined in ",(0,r.jsx)(t.code,{children:"conftest.py"}),":"]}),"\n",(0,r.jsx)(t.h3,{id:"observer-locations",children:"Observer Locations"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-python",children:'@pytest.fixture\ndef greenwich():\n    """Royal Observatory Greenwich (51.4772\xb0N, 0.0005\xb0W)"""\n    return Observer.from_degrees("Greenwich", 51.4772, -0.0005, elevation=62.0)\n\n@pytest.fixture\ndef mauna_kea():\n    """Mauna Kea Observatory (19.82\xb0N, 155.47\xb0W, 4207m)"""\n    return Observer.from_degrees("Mauna Kea", 19.82, -155.47, elevation=4207.0)\n\n@pytest.fixture\ndef paranal():\n    """ESO Paranal Observatory (-24.63\xb0S, 70.40\xb0W, 2635m)"""\n    return Observer.from_degrees("Paranal", -24.63, -70.40, elevation=2635.0)\n'})}),"\n",(0,r.jsx)(t.h3,{id:"famous-stars",children:"Famous Stars"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-python",children:'@pytest.fixture\ndef famous_stars():\n    """Dictionary of bright stars with ICRS coordinates."""\n    return {\n        \'sirius\': ICRSCoord.parse("06h45m08.9s -16d42m58s"),\n        \'vega\': ICRSCoord.parse("18h36m56.3s +38d47m01s"),\n        \'polaris\': ICRSCoord.parse("02h31m49.1s +89d15m51s"),\n        \'betelgeuse\': ICRSCoord.parse("05h55m10.3s +07d24m25s"),\n    }\n'})}),"\n",(0,r.jsx)(t.h3,{id:"reference-times",children:"Reference Times"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-python",children:'@pytest.fixture\ndef j2000():\n    """J2000.0 epoch (JD 2451545.0)"""\n    return JulianDate(2451545.0)\n\n@pytest.fixture\ndef vernal_equinox_2024():\n    """2024 March Equinox (JD 2460390.3)"""\n    return JulianDate(2460390.3)\n'})}),"\n",(0,r.jsx)(t.h2,{id:"writing-tests",children:"Writing Tests"}),"\n",(0,r.jsx)(t.h3,{id:"educational-docstrings",children:"Educational Docstrings"}),"\n",(0,r.jsx)(t.p,{children:"Tests should include educational docstrings explaining the astronomical concepts:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-python",children:'class TestAirmass:\n    """\n    Tests for airmass calculations.\n\n    Airmass quantifies the amount of atmosphere light must traverse\n    to reach an observer. At zenith (directly overhead), airmass = 1.0.\n    As objects approach the horizon, airmass increases dramatically:\n\n    - 90\xb0 altitude: X = 1.0 (zenith)\n    - 45\xb0 altitude: X \u2248 1.41 (\u221A2)\n    - 30\xb0 altitude: X \u2248 2.0 (practical observation limit)\n    - 10\xb0 altitude: X \u2248 5.8\n    -  0\xb0 altitude: X \u2192 \u221E (horizon)\n\n    The secant formula X = sec(z) = 1/cos(z) works well above 15\xb0.\n    Near the horizon, atmospheric refraction requires corrections.\n    """\n'})}),"\n",(0,r.jsx)(t.h3,{id:"step-annotations",children:"Step Annotations"}),"\n",(0,r.jsxs)(t.p,{children:["Use ",(0,r.jsx)(t.code,{children:"with allure.step()"})," for meaningful test steps:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-python",children:'def test_julian_century(self):\n    """Julian century = 36525 days (100 Julian years)."""\n    with allure.step("Define Julian year = 365.25 days"):\n        julian_year = 365.25\n\n    with allure.step("Calculate Julian century"):\n        julian_century = 100 * julian_year\n\n    with allure.step(f"Verify: {julian_century} = 36525"):\n        assert julian_century == 36525.0\n'})}),"\n",(0,r.jsx)(t.h3,{id:"golden-tests",children:"Golden Tests"}),"\n",(0,r.jsx)(t.p,{children:"Mark tests that validate against known reference values:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-python",children:'@pytest.mark.golden\n@allure.title("Speed of light = 299,792,458 m/s (exact)")\ndef test_speed_of_light(self):\n    """Speed of light is exact by SI definition since 2019."""\n    with allure.step("Verify c = 299,792,458 m/s"):\n        assert CONSTANTS.c.value == 299792458.0\n'})}),"\n",(0,r.jsx)(t.h2,{id:"coverage",children:"Coverage"}),"\n",(0,r.jsx)(t.p,{children:"Current test coverage by module:"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Module"}),(0,r.jsx)(t.th,{children:"Tests"}),(0,r.jsx)(t.th,{children:"Coverage"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"core.angles"})}),(0,r.jsx)(t.td,{children:"84"}),(0,r.jsx)(t.td,{children:"98%"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"core.coords"})}),(0,r.jsx)(t.td,{children:"38"}),(0,r.jsx)(t.td,{children:"95%"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"core.time"})}),(0,r.jsx)(t.td,{children:"46"}),(0,r.jsx)(t.td,{children:"97%"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"core.sun"})}),(0,r.jsx)(t.td,{children:"28"}),(0,r.jsx)(t.td,{children:"94%"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"core.moon"})}),(0,r.jsx)(t.td,{children:"26"}),(0,r.jsx)(t.td,{children:"92%"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"core.planets"})}),(0,r.jsx)(t.td,{children:"37"}),(0,r.jsx)(t.td,{children:"91%"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"core.visibility"})}),(0,r.jsx)(t.td,{children:"31"}),(0,r.jsx)(t.td,{children:"93%"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"core.constants"})}),(0,r.jsx)(t.td,{children:"28"}),(0,r.jsx)(t.td,{children:"100%"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.code,{children:"cli"})}),(0,r.jsx)(t.td,{children:"34"}),(0,r.jsx)(t.td,{children:"88%"})]})]})]}),"\n",(0,r.jsx)(t.p,{children:"Generate a detailed coverage report:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",children:"pytest --cov=starward --cov-report=html\nopen htmlcov/index.html\n"})})]})}function h(e={}){let{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453(e,t,s){s.d(t,{R:()=>l,x:()=>a});var n=s(6540);let r={},i=n.createContext(r);function l(e){let t=n.useContext(i);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),n.createElement(i.Provider,{value:t},e.children)}}}]);